#!/bin/bash
echo "" > cis
echo "IP:        `hostname -i`" &>> cis
echo "HOSTNAME:  `hostname -f`" &>> cis
echo "Date:      `date` "       &>> cis
echo "" >> cis
echo "" >> cis
echo "1.1.15 Ensure nodev option set on /dev/shm partition (Scored)" &>> cis
echo "command :  mount | grep /dev/shm " &>> cis
mount | grep /dev/shm &>> cis 

echo "" &>> cis
echo "" &>> cis

echo "1.1.16 Ensure nosuid option set on /dev/shm partition (Scored)" &>> cis
echo "command :  mount | grep /dev/shm  " &>> cis
mount | grep /dev/shm  &>> cis 

echo "" &>> cis
echo "" &>> cis

echo "1.1.21 Ensure sticky bit is set on all world-writable directories (Scored) " &>> cis
echo "command :  df --local -P | awk {'if (NR!=1) print $6'} | xargs -I '{}' find '{}' -xdev -type d \( -perm -0002 -a ! -perm -1000 \) 2>/dev/null  " &>> cis
df --local -P | awk {'if (NR!=1) print $6'} | xargs -I '{}' find '{}' -xdev -type d \( -perm -0002 -a ! -perm -1000 \) 2>/dev/null  &>> cis 


echo "" &>> cis
echo "" &>> cis

echo "1.2.1 Ensure package manager repositories are configured (Not Scored)" &>> cis
echo "command : zypper repos" &>> cis
zypper repos  &>> cis 


echo "" &>> cis
echo "" &>> cis

echo "1.2.2 Ensure GPG keys are configured (Not Scored)" &>> cis
echo "command : rpm -q gpg-pubkey --qf '%{name}-%{version}-%{release} --> %{summary}\n' " &>> cis
rpm -q gpg-pubkey --qf '%{name}-%{version}-%{release} --> %{summary}\n'  &>> cis 


echo "" &>> cis
echo "" &>> cis

echo "1.4.3 Ensure authentication required for single user mode (Not Scored)" &>>cis
echo "command : grep /sbin/sulogin /usr/lib/systemd/system/rescue.service  " &>>cis
grep /sbin/sulogin /usr/lib/systemd/system/rescue.service  &>>cis 
echo "command : grep /sbin/sulogin /usr/lib/systemd/system/emergency.service   " &>>cis
grep /sbin/sulogin /usr/lib/systemd/system/emergency.service   &>>cis 

echo "" &>>cis
echo "" &>>cis

echo "1.5.2 Ensure XD/NX support is enabled (Not Scored)" &>>cis
echo "command : dmesg | grep NX  " &>>cis
dmesg | grep NX   &>>cis 

echo "" &>>cis
echo "" &>>cis

echo "1.5.3 Ensure address space layout randomization (ASLR) is enabled (Scored)" &>>cis
echo "command : dmesg | grep NX  " &>>cis
dmesg | grep NX   &>>cis 

echo "" &>>cis
echo "" &>>cis

echo "1.5.4 Ensure prelink is disabled (Scored)" &>>cis
echo "command : rpm -q prelink " &>>cis
rpm -q prelink    &>>cis 

echo "" &>>cis
echo "" &>>cis

echo "1.6.1.1 Ensure SELinux is not disabled in bootloader configuration (Scored)" &>>cis
echo "command : grep "^\s*linux" /boot/grub2/grub.cfg " &>>cis
grep "^\s*linux" /boot/grub2/grub.cfg    &>>cis 

echo "" &>>cis
echo "" &>>cis

echo "1.6.1.4 Ensure SETroubleshoot is not installed (Scored)" &>>cis
echo "command : rpm -q setroubleshoot " &>>cis
rpm -q setroubleshoot   &>>cis 

echo "" &>>cis
echo "" &>>cis

echo "1.6.1.5 Ensure the MCS Translation Service (mcstrans) is not installed (Scored)" &>>cis
echo "command : rpm -q mcstrans " &>>cis
rpm -q mcstrans   &>>cis 

echo "" &>>cis
echo "" &>>cis

echo "1.6.1.6 Ensure no unconfined daemons exist (Scored)" &>>cis
echo "command : ps -eZ | egrep \"initrc\" | egrep -vw \"tr|ps|egrep|bash|awk \" | tr ':' ' ' | awk '{ print $NF }' " &>>cis
ps -eZ | egrep "initrc" | egrep -vw "tr|ps|egrep|bash|awk" | tr ':' ' ' | awk '{ print $NF }'   &>>cis 


echo "" &>>cis
echo "" &>>cis

echo "1.6.2.1 Ensure AppArmor is not disabled in bootloader configuration (Scored)" &>>cis
echo "command : grep "^\s*linux" /boot/grub2/grub.cfg " &>>cis
grep "^\s*linux" /boot/grub2/grub.cfg   &>>cis 

echo "" &>>cis
echo "" &>>cis

echo "1.6.3 Ensure SELinux or AppArmor are installed (Not Scored)" &>>cis
echo "command : rpm -q libselinux1 selinux-policy" &>>cis
rpm -q libselinux1 selinux-policy  &>>cis ; rpm -q libselinux1 selinux-policy   2&>>cis
echo "command : rpm -q libapparmor1 apparmor-utils" &>>cis
rpm -q libapparmor1 apparmor-utils  &>>cis 

echo "" &>>cis
echo "" &>>cis

echo "1.7.1.1 Ensure message of the day is configured properly (Scored)" &>>cis
echo "command : cat /etc/motd" &>>cis
cat /etc/motd  &>>cis


echo "" &>>cis
echo "" &>>cis

echo "1.7.1.2 Ensure local login warning banner is configured properly (Not Scored)" &>>cis
echo "command : cat /etc/issue" &>>cis
cat /etc/issue  &>>cis 
echo "command :egrep '(\\v|\\r|\\m|\\s)' /etc/issue" &>>cis
egrep '(\\v|\\r|\\m|\\s)' /etc/issue  &>>cis 


echo "" &>>cis
echo "" &>>cis

echo "1.7.1.3 Ensure remote login warning banner is configured properly (Not Scored)" &>>cis
echo "command : cat /etc/issue.net" &>>cis
cat /etc/issue.net  &>>cis 
echo "command : egrep '(\\v|\\r|\\m|\\s)' /etc/issue.net" &>>cis
egrep '(\\v|\\r|\\m|\\s)' /etc/issue.net  &>>cis 

echo "" &>>cis
echo "" &>>cis

echo "1.7.1.4 Ensure permissions on /etc/motd are configured (Not Scored)" &>>cis
echo "command : stat /etc/motd " &>>cis
stat /etc/motd   &>>cis 

echo "" &>>cis
echo "" &>>cis

echo "1.7.1.5 Ensure permissions on /etc/issue are configured (Scored)" &>>cis
echo "command : stat /etc/motd " &>>cis
stat /etc/issue    &>>cis 

echo "" &>>cis
echo "" &>>cis

echo "1.7.1.6 Ensure permissions on /etc/issue.net are configured (Not Scored)" &>>cis
echo "command : stat /etc/issue.net " &>>cis
stat /etc/issue.net     &>>cis 

echo "" &>>cis
echo "" &>>cis

echo "1.8 Ensure updates, patches, and additional security software are installed (Not Scored)" &>>cis
echo "command : zypper list-updates " &>>cis
zypper list-updates  &>>cis 

echo "" &>>cis
echo "" &>>cis

echo "2.1.1 Ensure chargen services are not enabled (Scored)" &>> cis
echo "verify chargen and chargen-udp are off or missing:" &>> cis
echo "2.1.2 Ensure daytime services are not enabled (Scored)" &>> cis
echo "verify daytime and daytime-udp are off or missing:" &>> cis
echo "2.1.3 Ensure discard services are not enabled (Scored)" &>> cis
echo "verify discard and discard-udp are off or missing " &>> cis
echo "2.1.4 Ensure echo services are not enabled (Scored)" &>> cis
echo "verify echo and echo-udp are off or missing:" &>>cis
echo "2.1.5 Ensure time services are not enabled (Scored)" &>> cis
echo "verify time and time-udp are off or missing: " &>>cis
echo "2.1.10 Ensure rsync service is not enabled (Scored)" &>> cis
echo "verify rsync is of or missing:" &>> cis

echo "command : chkconfig --list  " &>> cis
chkconfig --list      &>> cis 

echo "" &>> cis
echo "" &>> cis

echo "2.1.11 Ensure xinetd is not enabled (Scored)" &>>cis
echo "verify result is not "enabled": " &>>cis
echo "command : systemctl is-enabled xinetd   " &>>cis
systemctl is-enabled xinetd        &>>cis 

echo "" &>>cis
echo "" &>>cis

echo "2.2.1.1 Ensure time synchronization is in use (Not Scored)" &>>cis
echo "verify either ntp or chrony is installed: " &>>cis
echo "command : systemctl is-enabled xinetd   " &>>cis
systemctl is-enabled xinetd        &>>cis 



echo "" &>>cis
echo "" &>>cis

echo "2.2.1.2 Ensure ntp is configured (Scored)" &>>cis
echo "command : grep "^restrict" /etc/ntp.conf    " &>>cis
grep "^restrict" /etc/ntp.conf         &>>cis 
echo "command : grep "^server" /etc/ntp.conf     " &>>cis
grep "^server" /etc/ntp.conf          &>>cis 
echo "command : grep "^NTPD_OPTIONS" /etc/sysconfig/ntp   " &>>cis
grep "^NTPD_OPTIONS" /etc/sysconfig/ntp          &>>cis 


echo "" &>>cis
echo "" &>>cis

echo "2.3.1 Ensure NIS Client is not installed (Scored)" &>>cis
echo "verify ypbind is not installed: " &>>cis
echo "command : rpm -q ypbind   " &>>cis
rpm -q ypbind      &>>cis 

echo "" &>>cis
echo "" &>>cis

echo "2.3.3 Ensure talk client is not installed (Scored)" &>>cis
echo "verify talk is not installed:  " &>>cis
echo "command : rpm -q talk   " &>>cis
rpm -q talk      &>>cis 

echo "" &>>cis
echo "" &>>cis

echo "3.1.1 Ensure IP forwarding is disabled (Scored)" &>>cis
echo "command : sysctl net.ipv4.ip_forward    " &>>cis
sysctl net.ipv4.ip_forward       &>>cis 

echo "" &>>cis
echo "" &>>cis

echo "3.2.5 Ensure broadcast ICMP requests are ignored (Scored)" &>>cis
echo "command : sysctl net.ipv4.icmp_echo_ignore_broadcasts  " &>>cis
sysctl net.ipv4.icmp_echo_ignore_broadcasts     &>>cis 


echo "" &>>cis
echo "" &>>cis

echo "3.2.6 Ensure bogus ICMP responses are ignored (Scored)" &>>cis
echo "command : sysctl net.ipv4.icmp_ignore_bogus_error_responses " &>>cis
sysctl net.ipv4.icmp_ignore_bogus_error_responses     &>>cis 

echo "" &>>cis
echo "" &>>cis

echo "3.2.8 Ensure TCP SYN Cookies is enabled (Scored)	" &>>cis
echo "command : sysctl net.ipv4.tcp_syncookies " &>>cis
sysctl net.ipv4.tcp_syncookies     &>>cis 

echo "" &>>cis
echo "" &>>cis

echo "3.4.1 Ensure TCP Wrappers is installed (Scored)" &>>cis
echo "verify tcpd is installed: " &>>cis
echo "command : rpm -q tcpd  " &>>cis
rpm -q tcpd  &>>cis 

echo "" &>>cis
echo "" &>>cis

echo "3.4.2 Ensure /etc/hosts.allow is configured (Scored)" &>>cis
echo "verify the contents of the /etc/hosts.allow file: " &>>cis
echo "command : cat /etc/hosts.allow " &>>cis
cat /etc/hosts.allow  &>>cis 

echo "" &>>cis
echo "" &>>cis

echo "3.4.4 Ensure permissions on /etc/hosts.allow are configured (Scored)" &>>cis
echo "verify Uid and Gid are both 0/root and Access is 644: " &>>cis
echo "command : stat /etc/hosts.allow " &>>cis
stat /etc/hosts.allow  &>>cis 


echo "" &>>cis
echo "" &>>cis

echo "3.4.5 Ensure permissions on /etc/hosts.deny are 644 (Scored)" &>>cis
echo "verify Uid and Gid are both 0/root and Access is 644: " &>>cis
echo "command : stat /etc/hosts.deny  " &>>cis
stat /etc/hosts.deny   &>>cis 


echo "" &>>cis
echo "" &>>cis

echo "3.6.1 Ensure iptables is installed (Scored)" &>>cis
echo "verify iptables is installed: " &>>cis
echo "command : rpm -q iptables  " &>>cis
rpm -q iptables &>>cis 

echo "" &>>cis
echo "" &>>cis

echo "3.6.5 Ensure firewall rules exist for all open ports (Scored)" &>>cis
echo "Run the following command to determine open ports: " &>>cis
echo "command : netstat -ln  " &>>cis
netstat -ln &>>cis 

echo "" &>>cis
echo "" &>>cis

echo "4.1.1.1 Ensure audit log storage size is configured (Not Scored)" &>>cis
echo "ensure output is in compliance with site policy:  " &>>cis
echo "command :grep max_log_file /etc/audit/auditd.conf  " &>>cis
grep max_log_file /etc/audit/auditd.conf &>>cis 

echo "" &>>cis
echo "" &>>cis

echo "4.2.1.1 Ensure rsyslog Service is enabled (Scored)" &>>cis
echo "verify result is "enabled":  " &>>cis
echo "command :systemctl is-enabled rsyslog   " &>>cis
systemctl is-enabled rsyslog  &>>cis 

echo "" &>>cis
echo "" &>>cis

echo "4.2.1.2 Ensure logging is configured (Not Scored)" &>>cis
echo "Review the contents of the /etc/rsyslog.conf file to ensure appropriate logging is set  " &>>cis
echo " In the following command, verify that the log files are logging information:   " &>>cis
echo "command :ls -l /var/log/   " &>>cis
ls -l /var/log/ &>>cis 

echo "" &>>cis
echo "" &>>cis

echo "4.2.3 Ensure rsyslog or syslog-ng is installed (Scored)" &>>cis
echo "verify at least one indicates the package is installed: " &>>cis
echo "command :rpm -q rsyslog   " &>>cis
rpm -q rsyslog &>>cis 
echo "command :rpm -q rsyslog   " &>>cis
rpm -q syslog-ng &>>cis 

echo "" &>>cis
echo "" &>>cis

echo "4.3 Ensure logrotate is configured (Not Scored)" &>>cis
echo "Review /etc/logrotate.conf and /etc/logrotate.d/* and verify logs are rotated according to site policy.:  " &>>cis
echo "command : cat /etc/logrotate   " &>>cis
systemctl is-enabled rsyslog  &>>cis 
echo "command : ls -a /etc/logrotate.d/* " &>> cis
ls -a /etc/logrotate.d/* &>> cis


echo "" &>>cis
echo "" &>>cis

echo "5.1.1 Ensure cron daemon is enabled (Scored)" &>>cis
echo "verify result is "enabled":  " &>>cis
echo "command :systemctl is-enabled cron   " &>>cis
systemctl is-enabled cron   &>>cis 


echo "" &>>cis
echo "" &>>cis

echo "5.1.2 Ensure permissions on /etc/crontab are configured (Scored)" &>>cis
echo "verify Uid and Gid are both 0/root and Access does not grant permissions to group or other:" &>>cis
echo "command : stat /etc/crontab    " &>>cis
stat /etc/crontab    &>>cis 

echo "" &>>cis
echo "" &>>cis

echo "5.2.10 Ensure SSH PermitUserEnvironment is disabled (Scored)" &>>cis
echo "Run the following command and verify that output matches: PermitUserEnvironment no " &>>cis
echo "command : grep PermitUserEnvironment /etc/ssh/sshd_config " &>>cis
grep PermitUserEnvironment /etc/ssh/sshd_config     &>>cis 

echo "" &>>cis
echo "" &>>cis

echo "5.4.3 Ensure default group for the root account is GID 0 (Scored)" &>>cis
echo "verify the result is 0: " &>>cis
echo "command : grep "^root:" /etc/passwd | cut -f4 -d: " &>>cis
grep "^root:" /etc/passwd | cut -f4 -d:   &>>cis 


echo "" &>>cis
echo "" &>>cis

echo "6.1.2 Ensure permissions on /etc/passwd are configured (Scored) " &>>cis
echo "verify Uid and Gid are both 0/root and Access is 644: " &>>cis
echo "command : stat /etc/passwd " &>>cis
stat /etc/passwd   &>>cis 


echo "" &>>cis
echo "" &>>cis

echo "6.1.4 Ensure permissions on /etc/group are configured (Scored) " &>>cis
echo "verify Uid and Gid are both 0/root and Access is 644: " &>>cis
echo "command :stat /etc/group  " &>>cis
stat /etc/group    &>>cis 


echo "" &>>cis
echo "" &>>cis

echo "6.1.10 Ensure no ungrouped files or directories exist (Scored)" &>>cis
echo "verify no files are returned:  " &>>cis
echo "command :df --local -P | awk {'if (NR!=1) print $6'} | xargs -I '{}' find '{}' -xdev -nogroup " &>>cis
df --local -P | awk {'if (NR!=1) print $6'} | xargs -I '{}' find '{}' -xdev -nogroup  &>>cis 


echo "" &>>cis
echo "" &>>cis

echo "6.2.1 Ensure password fields are not empty (Scored) " &>>cis
echo "verify that no output is returned: " &>>cis
echo "command :cat /etc/shadow | awk -F: '($2 == "" ) { print $1 " does not have a password "}' " &>>cis
cat /etc/shadow | awk -F: '($2 == "" ) { print $1 " does not have a password "}'    &>>cis 

echo "" &>>cis
echo "" &>>cis

echo "6.2.2 Ensure no legacy "+" entries exist in /etc/passwd (Scored) " &>>cis
echo " verify that no output is returned:  " &>>cis
echo "command :grep '^+:' /etc/passwd " &>>cis
grep '^+:' /etc/passwd   &>>cis 


echo "" &>>cis
echo "" &>>cis

echo "6.2.3 Ensure no legacy "+" entries exist in /etc/shadow (Scored) " &>>cis
echo " verify that no output is returned: " &>>cis
echo "command :grep '^+:' /etc/shadow " &>>cis
grep '^+:' /etc/shadow  &>>cis 


echo "" &>>cis
echo "" &>>cis

echo "6.2.4 Ensure no legacy "+" entries exist in /etc/group (Scored)" &>>cis
echo " verify that no output is returned:  " &>>cis
echo "command :grep '^+:' /etc/shadow " &>>cis
grep '^+:' /etc/group  &>>cis 

echo "" &>>cis
echo "" &>>cis

echo "6.2.5 Ensure root is the only UID 0 account (Scored)" &>>cis
echo " verify that only "root" is returned:   " &>>cis
echo "command :cat /etc/passwd | awk -F: '($3 == 0) { print $1 }'" &>>cis
cat /etc/passwd | awk -F: '($3 == 0) { print $1 }'  &>>cis 

echo "" &>>cis
echo "" &>>cis

echo "6.2.6 Ensure root PATH Integrity (Scored)" &>>cis
echo " verify no results are returned:  " &>>cis
echo "command :grep '^+:' /etc/shadow " &>>cis
grep '^+:' /etc/group  &>>cis 
